<dom-module id="appstore-packages">
    <template>
        <style>
            :host {
                display: none;
            }

            :host([active]) {
                display: block;
            }

            iron-list {
                margin-top: 20px;
            }

            .packageContent {
                @apply(--layout);
                background-color: #fff;
                position: relative;
                width: 370px;
                height: 270px;
                margin: 10px;
            }

            .packageContent> paper-card {
                @apply(--layout-flex);
            }

            #heading {
                background-color: #fff;
                font-family: 'Roboto', 'Noto', sans-serif;
                width: auto;
                padding: 10px;
                margin-top: 20px;
            }

            paper-card:hover {
                @apply(--shadow-elevation-8dp);
            }

            #heading span {
                font-weight: 100;
                font-size: 80px;
            }

            #heading div {
                padding: 10px;
                font-weight: 300;
                font-size: 22px;
            }

            .box {
                font-family: 'Roboto', 'Noto', sans-serif;
                padding: 12px;
            }

            .box a {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 1;
            }

            #head {
                font-size: 24px;
                font-weight: 400;
                color: #000;
            }

            #owner {
                font-weight: 100;
                font-size: 16px;
            }

            #desc {
                font-weight: 300;
                font-size: 18px;
            }
        </style>
        <div id="packagesPage">
            <iron-ajax auto="true" url="[[_computeDetailsURL(category)]]" handle-as="json" last-response="{{ajaxResponse}}"></iron-ajax>
            <iron-ajax auto="true" url="[[_computeRepoURL(category)]]" handle-as="json" last-response="{{repoInfo}}"></iron-ajax>

            <platinum-sw-register skip-waiting clients-claim auto-register auto-register>
                <platinum-sw-cache default-cache-strategy="fastest"></platinum-sw-cache>
            </platinum-sw-register>

            <paper-card animated-shadow id="heading">
                <span>{{repoInfo.name}}.</span>
                <div>{{repoInfo.desc}}</div>
                <div>Created On: {{repoInfo.created}}</div>
                <div>Packages Available: {{repoInfo.package_count}}</div>
            </paper-card>

            <iron-list items="[[ajaxResponse]]" grid on-dom-change="_onDomChange">
                <template>
                    <div class="packageContainer">
                        <div class="packageContent" tabindex$="[[tabIndex]]">
                            <paper-card animated-shadow class="box">
                                <div id="head">[[item.name]]</div>
                                <a href="#/details/[[category]]/[[item.name]]"></a>
                                <div id="owner">by [[item.owner]]</div>
                                <div class="gold">
                                    <star-rating stars="5" rate="[[item.rating]]"></star-rating>
                                </div>
                                <div id="desc">[[_filterContent(item.desc)]]...</div>
                            </paper-card>
                        </div>
                    </div>
                </template>
            </iron-list>
        </div>
        <appstore-footer></appstore-footer>
    </template>
    <script>
        Polymer({
            is: 'appstore-packages',

            behaviors: [
                Polymer.NeonAnimatableBehavior,
                Polymer.NeonSharedElementAnimatableBehavior,
                Polymer.NeonAnimationRunnerBehavior
            ],

            properties: {

                active: {
                    type: Boolean,
                    value: false,
                    reflectToAttribute: true
                },

                packageData: Object,

                repoInfo: Object,

                animationConfig: {
                    value: function() {
                        return {
                            'entry': [{
                                name: 'cascaded-animation',
                                animation: 'scale-up-animation',
                                timing: {
                                    delay: 500
                                }
                            }],
                            'exit': [{
                                name: 'fade-out-animation',
                                node: this,
                                timing: {
                                    delay: 100,
                                    duration: 500
                                }
                            }],
                        }
                    }
                },
            },

            _computeRepoURL(category) {
                return 'http://localhost:3000/repositories?repo=' + category;
            },

            _computeDetailsURL(category) {
                return 'http://localhost:3000/alldetails?repo=' + category;
            },

            _filterContent(str) {
                return str.substr(0, 160);
            },

            _onDomChange:function(){
                var nodeList = Polymer.dom(this.root).querySelectorAll('.box');
                this.animationConfig['entry'][0].nodes = Array.prototype.slice.call(nodeList);
                this.playAnimation('entry');
            }
        });
    </script>
</dom-module>
